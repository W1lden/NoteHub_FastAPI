# Note App — Часть #2

## Техническое задание

К существующему приложению **Note App** (Часть #1) необходимо добавить HTML-интерфейс с использованием **Jinja2**, подключить статические файлы (CSS, JS, изображения) и реализовать страницу анонимного чата через **WebSocket**.  

Все страницы должны иметь собственные HTML-шаблоны и общий базовый шаблон с шапкой/меню и подвалом.  
История анонимного чата должна сохраняться в **нереляционной БД** (тип key-value, например Redis) и включать события входа/выхода пользователя.

---

## Технологический стек

- Python + FastAPI
- Jinja2 (шаблоны)
- HTML + CSS + JavaScript
- WebSocket (встроенный в FastAPI/Starlette) / Broadcaster
- Redis (или аналогичная key-value БД)

---

## Требования к функциональности

### 1. Общий интерфейс
- Использовать **Jinja2** для генерации HTML-страниц.
- Все страницы должны наследоваться от базового шаблона (`base.html`), в котором присутствует:
  - шапка сайта с логотипом и навигацией и подвал;
  - меню с ссылками: **Главная**, **Новая заметка**, **Чат**, **Вход**, **Регистрация** (или **Выйти**, если пользователь авторизован);
- Подключить статические файлы (**/static**): CSS-стили, JS-скрипты, изображения.
- В шапке отображать email текущего пользователя при авторизации.

### 2. Страницы аутентификации
Реализовать HTML-страницы с формами:
- **Регистрация**:
  - поля: email, пароль;
  - проверка уникальности email;
  - после регистрации — автоматическая авторизация пользователя.
    
- **Вход**:
  - поля: email, пароль;
  - при неверных данных выводить сообщение об ошибке.
    
- **Выход**:
  - выход из системы по нажатию кнопки/ссылки.
- Все пароли хранить в хэшированном виде.
- Для HTML-версии авторизации использовать cookie-сессии (опционально).
  
- **Новая запетка**:
  - Форма для создания заметки (доступна только аутентифицированным пользователям);
    
- **Страница заметки**:
  - Данные о заметке;
  - Кнопка изменения заметки (с проверкой прав);
  - Кнопка удаления заметки (с проверкой прав).
    
### 3. Главная страница
- Приветственный текст.
- Если пользователь авторизован — отображать его заметки.

### 4. Страница анонимного чата
- Доступна по адресу `/chat`.
- Отображает:
  - список сообщений (история чата);
  - форму для ввода никнейма (обязательное поле перед подключением к чату);
  - форму для ввода сообщения после подключения.
- Никнейм пользователя:
  - задаётся **один раз** перед входом в чат;
  - используется для всех его сообщений до выхода.
- Сообщения отправляются через **WebSocket** на адрес `/ws/anon-chat`.
- Поддержка нескольких пользователей:
  - все сообщения и события транслируются всем подключённым клиентам;
  - при входе/выходе участника выводится сообщение.
- История чата:
  - хранится в **Redis** (или другой key-value БД);
  - должна включать:
    - сообщения пользователей;
    - события входа и выхода с указанным никнеймом;
  - при входе нового пользователя загружается и отображается **последние 20 событий**.

---

### 5. Структура хранения истории в Redis

Для хранения истории и событий в чате использовать **список** (`list`) в Redis с ключом `chat:history`.

Каждое сообщение или событие хранится как JSON-объект в строке.

Пример структуры записи:
```json
{
  "type": "message",          // "message" или "system"
  "timestamp": "2025-08-15T12:34:56",
  "nickname": "Guest-1234",   // никнейм отправителя, пусто для system-сообщений
  "text": "Привет всем!"      // текст сообщения или описание события
}
```
---

### 6. Вёрстка и статика
- Все страницы должны быть оформлены через подключённые CSS-стили.
- Добавить в /static изображения (логотип и при необходимости фоновые картинки).
- JavaScript:
  - отдельный файл для логики чата (подключение к WebSocket, отправка и приём сообщений, вывод в HTML).
 
---

### 7. Развёртывание
- Проект должен запускаться в Docker (добавить в docker-compose.yml сервис Redis).
- После сборки контейнера статика, шаблоны и чат должны работать без дополнительных действий.
- Опционально выложить проект на render

---

### 8. Документация
- Описать в README.md:
  - структуру шаблонов и статики;
  - список новых URL-адресов;
  - формат сохранения истории чата в Redis;
  - как протестировать чат (например, открыть в двух вкладках).
